---
title: 29 理解数据在磁盘上的物理存储之后，聊聊行溢出是什么东西？
category:
  - MySQL
date: 2023-02-27
---

<!-- more -->


> **今天我们来聊聊行数据的物理存储的一个高阶的话题，就是行溢出到底是个什么东西？**

实际上我们每一行数据都是放在一个数据页里的，这个数据页默认的大小是**16KB**，那么之前就有人在后台提过一个问题：万一 一行数据的大小超过了页的大小怎么办呢？

比如有一个表的字段类型是 `VARCHAR(65532)`，意思就是最大可以包含65532个字符，那也就是65532个字节，这就远大于16kb的大小了，也就是说这一行数据的这个字段都远超一个数据页的大小了！

这个时候实际上会在那一页里存储你这行数据，然后在那个字段中，仅仅包含他一部分数据，同时包含一个**20个字节的指针**，指向了其他的一些数据页，那些**数据页用链表串联起来**，存放这个VARCHAR(65532)超大字段里的数据。

我们看下图，就给出了这个示意。

<img src="https://studyimages.oss-cn-beijing.aliyuncs.com/img/mysql/01-33/202210201131562.png" alt="image-20220126174043001"/>

上面说的这个过程，其实就叫做**行溢出**，就是说一行数据存储的内容太多了，一个数据页都放不下了，此时只能溢出这个数据页，把数据溢出存放到其他数据页里去，那些数据页就叫做溢出页。

包括其他的一些字段类型都是一样的，比如`TEXT`、`BLOB`这种类型的字段，都有可能出现溢出，然后一行数据就会存储在多个数据页里。



> **总结**

当我们在数据库里插入一行数据的时候，实际上是在内存里插入一个有复杂存储结构的一行数据，然后随着一些条件的发生，这行数据会被刷到磁盘文件里去。

在磁盘文件里存储的时候，这行数据也是按照复杂的存储结构去存放的。而且每一行数据都是放在数据页里的，如果一行数据太大了，就会产生行溢出问题，导致一行数据溢出到多个数据页里去，那么这行数据在Buffer Pool可能就是存在于多个缓存页里的，刷入到磁盘的时候，也是用磁盘上的多个数据页来存放这行数据的。

接下来，我们就会开始讲解数据页的物理存储结构，然后是表空间的物理存储结构，最后是讲解这些数据以物理存储结构的方式，在磁盘上存储的时候，是放在哪些磁盘文件里的。
