---
title: 30 用于存放磁盘上的多行数据的数据页到底长个什么样子？
category:
  - MySQL
date: 2023-02-27
---

<!-- more -->

> **数据页到底是长什么样子?**

一个数据页拆分成了很多个部分，大体上来说包含了`文件头`、`数据页头`、`最小记录`和`最大记录`、`多个数据行`、`空闲空间`、`数据页目录`、`文件尾部`。

如图所示。

<img src="https://studyimages.oss-cn-beijing.aliyuncs.com/img/mysql/01-33/202210201131377.png" alt="image-20220126182955513"/>

其中文件头占据了38个字节，数据页头占据了56个字节，最大记录和最小记录占据了26个字节，数据行区域的大小是不固定的，空闲区域的大小也是不固定的，数据页目录的大小也是不固定的，然后文件尾部占据8个字节。

其实也没什么好奇怪的，说白了，这个**数据页**就跟每一行数据一样，都是由MySQL开发人员设计出来的一个**特殊的存储格式**。

也就是说通过这种特殊的存储格式在磁盘文件里去存放一个又一个的数据页，每个数据页在磁盘里实际存储的时候，就是包含了上述一些特殊的数据，然后每个数据页里还有专门的区域包含了多个数据行，至于每个数据行，那就是用我们之前讲解的那套存储格式来存储的了。

接着我们给大家讲一下这个把数据插入数据页的一个过程，因为大家都知道，刚开始一个数据页可能是空的，没有一行数据的，此时这个数据页实际上是没有数据行那个区域的。

也就是说，此时看起来一个空的数据页就是下面图里那样的。

<img src="https://studyimages.oss-cn-beijing.aliyuncs.com/img/mysql/01-33/202210201131378.png" alt="image-20220126183826298"/>

然后我们来思考一下，假设我们现在要插入一行数据，此时数据库里可是一行数据都没有的，那么此时是不是应该先是从磁盘上加载一个空的数据页到缓存页里去？

此时空的数据页就是如上图所示，至于加载的过程，则如下图所示。

<img src="https://studyimages.oss-cn-beijing.aliyuncs.com/img/mysql/01-33/202210201131379.png" alt="image-20220126184120283"/>

接着我们是不是应该在Buffer Pool中的一个空的缓存页里插入一条数据？

记住，缓存页跟数据页是一 一对应的，他在磁盘上的时候就是数据页，数据页加载到缓存页里了，我们就叫他缓存页了！

所以此时在缓存页里插入一条数据，实际上就是在数据行那个区域里插入一行数据，然后空闲区域的空间会减少一些，此时当缓存页里插入了一行数据之后，其实缓存页此时看起来如下图所示。

<img src="https://studyimages.oss-cn-beijing.aliyuncs.com/img/mysql/01-33/202210201131380.png" alt="image-20220126184404911"/>

接着你就可以不停的插入数据到这个缓存页里去，直到他的空闲区域都耗尽了，就是这个页满了，此时数据行区域内可能有很多行数据，如下图所示，空闲区域就没了。

![image-20220126184425941](https://studyimages.oss-cn-beijing.aliyuncs.com/img/mysql/01-33/202210201131381.png)

而且大家都知道，在更新缓存页的同时，其实他在lru链表里的位置会不停的变动，而且肯定会在flush链表里，所以最终他一定会通过后台IO线程根据lru链表和flush链表，把这个脏的缓存页刷到磁盘上去，如下图所示。

<img src="https://studyimages.oss-cn-beijing.aliyuncs.com/img/mysql/01-33/202210201131382.png" alt="image-20220126184500287"/>

因此对于数据页的整体存储结构的初步介绍，以及MySQL实际运行过程中，数据页的使用，我们今天就介绍完了，接下来我们会继续去了解`表空间`、`数据区`、`数据段`这些物理存储中的概念。
