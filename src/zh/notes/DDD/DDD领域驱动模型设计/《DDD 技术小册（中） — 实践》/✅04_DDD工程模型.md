---
title: âœ…04 | DDDå·¥ç¨‹æ¨¡å‹
category:
  - DDD
tag: 
  - DDD
date: 2025-10-22
---

<!-- more -->

## å¼€ç¯‡

**ä»€ä¹ˆæ˜¯ç³»ç»Ÿçš„å·¥ç¨‹ç»“æ„ï¼Œå·¥ç¨‹æ¡†æ¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ**

- å…¶å®ï¼Œå·¥ç¨‹ç»“æ„çš„å­˜åœ¨ä½œç”¨ç›®çš„ï¼Œæ˜¯ä¸ºäº†æ‰¿è½½å·¥ç¨‹ç³»ç»Ÿå¼€å‘çš„æ¨¡å‹åˆ’åˆ†ï¼Œå®šä¹‰å·¥ç¨‹æœåŠ¡å¼€å‘è¿‡ç¨‹ä¸­å®æ–½æ ‡å‡†ã€‚è¯´ç™½äº†ï¼Œå°±æ˜¯ä½ åœ¨å·¥ç¨‹å®ç°æ—¶ï¼Œåœ¨å“ªä¸ªå±‚è®¿é—®æ•°æ®åº“ã€å“ªä¸ªå±‚ä½¿ç”¨ç¼“å­˜ã€å“ªä¸ªå±‚è°ƒç”¨å¤–éƒ¨æ¥å£ã€å“ªä¸ªå±‚åšåŠŸèƒ½å®ç°ï¼Œè¿™å°±æ˜¯å·¥ç¨‹æ¡†æ¶ç»“æ„å®šä¹‰çš„ç›®çš„ã€‚
- ä½†åœ¨ `Service + è´«è¡€æ¨¡å‹` çš„ä¸‰å±‚ç»“æ„å¼€å‘æŒ‡å¯¼ä¸‹ï¼Œæ˜¯æ²¡æœ‰ç»†åˆ†å‡ºé¢å‘å¯¹è±¡å·¥ç¨‹ç»“æ„è®¾è®¡çš„è¶‹äºåˆ’åˆ†çš„ã€‚æ‰€ä»¥åœ¨é€šå¸¸æ„ä¹‰çš„ MVC ä¸‹ï¼Œå¼€å‘è¿‡ç¨‹æ‰€æœ‰éœ€è¦çš„å†…å®¹ï¼Œéƒ½ä¼šå †ç Œåˆ° Service å®ç°ç±»ä¸­ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ DDD é¢†åŸŸé©±åŠ¨è®¾è®¡çš„è½åœ°å·¥ç¨‹ç»“æ„ï¼Œä¼šå‡ºç°ï¼›æ´‹è‘±æ¶æ„ã€æ•´æ´æ¶æ„ã€è±å½¢æ¶æ„ã€å…­è¾¹å½¢æ¶æ„ç­‰è¿™äº›æ¶æ„æ¨¡å‹ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦æ›´ç»†è‡´çš„åˆ’åˆ†ï¼Œæ¥æ‰¿è½½ DDD è®¾è®¡æ¦‚å¿µä¸­æ˜ å°„çš„é¢†åŸŸã€ä»“å‚¨ã€é€‚é…ã€ç¼–æ’ã€è§¦å‘ï¼Œå¹¶é‡è§†é¢å‘å¯¹è±¡è¿‡ç¨‹ã€‚â€”â€” å…¶å®ä½ ä¸€ä¸Šå­¦ï¼Œå­¦Javaå°±å¼€å§‹å­¦é¢å‘å¯¹è±¡äº†ï¼Œåªä¸è¿‡ä¸€ç‚¹ç‚¹åœ¨å¿˜è®°å®ƒã€‚

## ä¸€ã€ä¸ºå•¥éœ€è¦æ¶æ„

è¯´åˆ°å¼€å‘ä»£ç ä¸ºå•¥éœ€è¦æ¶æ„ï¼Œå°±æƒ³ä¹°äº†ä¸ªæˆ¿å­ï¼Œä¸ºå•¥è¦éš”å‡ºå¨æˆ¿ã€å®¢å…ã€å§å®¤ã€å«ç”Ÿé—´ä¸€æ ·ï¼Œæ ¸å¿ƒç›®çš„å°±æ˜¯è®©ä¸åŒçš„èŒè´£åˆ†é…åˆ°ä¸åŒçš„åŒºåŸŸå†…ã€‚è™½ç„¶åœ¨ä»£ç ä¸­æ˜¯æ²¡æœ‰é©¬æ¡¶è¦æ”¾å«ç”Ÿé—´ã€æ²™å‘è¦æ”¾å®¢å…ã€åºŠè¦æ”¾å§å®¤ã€‚ä½†ä»–æœ‰ä¸€äº›åˆ—çš„ç§‘ç›®ä¿¡æ¯è¦å¼•å…¥åˆ°å·¥ç¨‹ã€‚

**åœ¨å·¥ç¨‹å¼€å‘æ—¶ä¼šæ¶‰åŠåˆ°çš„æ ¸å¿ƒç§‘ç›®ï¼›**

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/ddd-easy-guide-03-01.png)

å¦‚ï¼›ç»Ÿä¸€çš„å¼‚å¸¸ã€æ•°æ®åº“çš„è¿æ¥ã€æ—¥å¿—çš„æ‰“å°ã€å¤–éƒ¨æœåŠ¡çš„è°ƒç”¨ã€æ¶ˆæ¯çš„ç›‘å¬ã€ä»»åŠ¡çš„è½®è®­ä»¥åŠæœåŠ¡çš„å®ç°ç­‰ä¸€äº›åˆ—çš„ä¸œè¥¿è¦å¤„ç†ï¼Œåˆ†é…åˆ°ä¸åŒçš„å·¥ç¨‹åŒ…ä¸‹æ‰¿è½½ã€‚åœ¨ DDD ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸€ç›´ç”¨ MVC çš„åˆ†å±‚ç»“æ„æ‰¿æ¥è¿™äº›å†…å®¹ï¼›

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/ddd-easy-guide-03-02.png)

é€šç”¨çš„ã€é…ç½®çš„ã€ç»„ä»¶çš„ã€æŒä¹…åŒ–çš„ã€å†…éƒ¨çš„ã€å¤–éƒ¨çš„ï¼Œåœ¨ä»¥å¾€çš„å•ä½“åº”ç”¨æ—¶ä»£å¼€å‘ä¸‹ï¼Œå…¶å®æ˜¯æ²¡æœ‰è¿™ä¹ˆå¤šä¸œè¥¿çš„ï¼Œé‚£æ—¶å€™çš„å·¥ç¨‹ç»“æ„éƒ½åå‘äº Service + è´«è¡€æ¨¡å‹å®ç°ã€‚

ä½†éšç€å¾®æœåŠ¡çš„æ¼”è¿›ï¼Œè¶Šæ¥è¶Šå¤šçš„å†…å®¹è¢«å¡«å……åˆ°å·¥ç¨‹ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ä½ ç»†å¿ƒçš„æŸ¥çœ‹æ¶æ„ï¼Œå°±ä¼šå‘ç°åŸæœ¬çš„ MVC ç»“æ„å…¶å®å·²ç»å˜çš„éå¸¸æ··ä¹±äº†ã€‚ä¸€ä¸ª Service ä¸­ä¸ºäº†å®ç°è‡ªå·±çš„åŠŸèƒ½ï¼Œè¦å¼•å…¥ä¸€å †çš„ä¸œè¥¿ï¼Œè¿™äº›åŸå­çš„åŠŸèƒ½ä¸ Service è‡ªèº«çš„æœåŠ¡è€¦åˆåœ¨ä¸€å—ã€‚ä¹Ÿå¯¼è‡´äº†å·¥ç¨‹çš„ç»´æŠ¤æˆæœ¬è¶Šæ¥è¶Šå¤§ã€‚

> è¿™æ ·çš„ä¸‰å±‚å·¥ç¨‹ç»“æ„åˆ†é…æ–¹å¼ï¼Œå¯¹äºè¦æ‰¿è½½åºå¤§çš„åˆ†å¸ƒå¼æŠ€æœ¯æ ˆä½“ç³»æ˜¾ç„¶æ˜¯æœ‰ç‚¹å°é©¬æ‹‰å¤§è½¦ï¼Œä¸‰ç¼¸æœºå¸¦ä¸åŠ¨SUVä¸€æ ·ã€‚

## äºŒã€å·¥ç¨‹ç»“æ„è®¾è®¡

2004å¹´ï¼ŒEric Evans åœ¨å‘è¡¨äº†ä¸€éƒ¨åä¸ºã€ŠDomain Driven Designã€‹çš„è‘—ä½œã€‚2005å¹´ Alistair Cockburn æå‡ºçš„â€œå…­è¾¹å½¢å…³ç³»å›¾â€ç†è®ºï¼Œ2008å¹´ Jeffrey Palermo æå‡ºäº†æ´‹è‘±æ¶æ„ã€‚è™½ç„¶è¿™äº›æ¶æ„å¹¶ä¸æ˜¯ä¸“é—¨ä¸º DDD è€Œå‡ºï¼Œä½†å·§çš„æ˜¯è¿™äº›æ¶æ„éƒ½åœ¨ DDD ä¸€ä¹¦å‘è¡¨ä¹‹åé™†ç»­æ¨å‡ºæ–°çš„æ¶æ„æ¨¡å‹ã€‚åŒæ—¶è¿™äº›æ¶æ„çš„åˆ†å±‚è®¾è®¡æ–¹å¼ä¹Ÿéƒ½ä¸ DDD éå¸¸å¥‘åˆï¼Œåœ¨è¿™äº›æ¶æ„ä¸‹ä¹Ÿå¯ä»¥å¾ˆå¥½çš„è½åœ° DDD è®¾è®¡æ–¹æ³•ã€‚

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/ddd-easy-guide-03-03.png)

æ— è®ºæ˜¯å…­è¾¹å½¢æ¶æ„ï¼Œè¿˜æ˜¯æ´‹è‘±æ¶æ„ï¼Œæˆ–æ˜¯[å¼ æ¯…è€å¸ˆ](http://zhangyi.xyz/)æåˆ°çš„å—å‘ç½‘å…³/åŒ—å‘ç½‘å…³çš„è±å½¢æ¶æ„ï¼Œä»–ä»¬çš„ç›®æ ‡éƒ½æ˜¯ä»¥é¢†åŸŸæœåŠ¡ä¸ºæ ¸å¿ƒï¼Œéš”ç¦»å†…éƒ¨å®ç°ä¸å¤–éƒ¨èµ„æºçš„è€¦åˆã€‚

åœ¨ DDD åˆ†å±‚æ¶æ„ä¸‹ï¼Œä»¥æ”¯æ’‘ domain æ ¸å¿ƒé¢†åŸŸå®ç°æ‹†åˆ†å‡ºåŸºç¡€è®¾æ–½ï¼ˆinfrastructureï¼‰ï¼Œæ¥æ‰¿æ¥å¯¹å¤–éƒ¨èµ„æºçš„è°ƒç”¨ã€‚è§¦å‘å™¨ï¼ˆtriggerï¼‰å‘å¤–éƒ¨æä¾›æœåŠ¡ã€‚ä¹‹å app ä¸ºåº”ç”¨å¯åŠ¨ã€api ä¸ºæ¥å£å®šä¹‰ã€types ä¸ºé€šç”¨ä¿¡æ¯ã€case ä¸ºç¼–æ’ã€‚

åœ¨è¿™æ ·ä¸€å¥—ç»“æ„ä¸‹ï¼Œç”¨äºå¼€å‘å·¥ç¨‹çš„å„é¡¹ç§‘ç›®ä¹Ÿå¯ä»¥è¢«ä¼˜é›…çš„åˆ†é…åˆ°å„ä¸ªåˆ†å±‚ç»“æ„äº†ã€‚ç›¸å¯¹äº Service + æ•°æ®æ¨¡å‹çš„è´«è¡€æ¨¡å‹ç»“æ„ï¼Œç°åœ¨å°±ä¸»è¦ä»¥ domain ä¸ºæ ¸å¿ƒå¼€å‘ä¸šåŠ¡åŠŸèƒ½ï¼Œä¸ä¼šåœ¨ domain å·¥ç¨‹æ¨¡å—ä¸‹ï¼Œå¼•å…¥å…¶ä»–å„ç±»å¤–éƒ¨ç»„ä»¶äº†ï¼Œè¿™æ ·å°±å¯ä»¥æ›´åŠ å…³å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘ã€‚

ä¹‹åæ˜¯è¿™æ ·çš„æ€æƒ³æ˜ å°„åˆ°å·¥ç¨‹ä¸­ï¼Œå¸¸è§çš„åˆ†å±‚ç»“æ„ä¼šæœ‰ä¸¤å¥—ï¼Œä¸€å¥—æ˜¯æ•´æ´åˆ†å±‚ï¼Œå¦å¤–ä¸€å¥—æ˜¯å…­è¾¹å½¢åˆ†å±‚ã€‚

### 1. æ•´æ´æ¶æ„ - å·¥ç¨‹ç»“æ„

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/ddd-easy-guide-03-04.png)

- æ•´æ´æ¶æ„çš„åˆ†åŒ…å½¢å¼ï¼Œä¼šå°†æ‰€æœ‰çš„å¤–éƒ¨ä¾èµ–ä½¿ç”¨å’Œå·¥ç¨‹å†…è¦å¯¹å¤–çš„ï¼Œç»Ÿä¸€å®šä¹‰åˆ°é€‚é…å™¨å±‚ã€‚è¿™é‡Œå¯ä»¥ç†è§£ä¸ºå¯¹é€‚é…å’Œå¯¹å†…é€‚é…ã€‚
- é˜¿é‡Œçš„ cola åæ•´æ´æ¶æ„ [é˜¿é‡Œæ¶æ„ cola çš„ç›¸å…³å†…å®¹](https://www.aliyun.com/sswb/610119.html)

### 2. å…­è¾¹å½¢æ¶æ„ - å·¥ç¨‹ç»“æ„

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/ddd-easy-guide-03-05.png)

å…­è¾¹å½¢æ¶æ„ï¼Œä¼šæŠŠæœ¬èº«æä¾›åˆ°å¤–éƒ¨çš„æ”¾åˆ°triggerï¼Œè®©æ¥å£è°ƒç”¨ã€æ¶ˆæ¯ç›‘å¬ã€ä»»åŠ¡è°ƒåº¦ï¼Œéƒ½å¯ä»¥ç»Ÿä¸€ä¸€ä¸ªå…¥å£å¤„ç†ã€‚è€Œå¯¹äºéœ€è¦è°ƒç”¨å¤–éƒ¨åŒç±»çš„èƒ½åŠ›ç»Ÿä¸€æ”¾åˆ° infrastructure åŸºç¡€è®¾æ–½å±‚ï¼ŒåŒ…æ‹¬ï¼›æ•°æ®åº“ã€ç¼“å­˜ã€é…ç½®ã€è°ƒç”¨å…¶ä»–æ–¹çš„æ¥å£ã€‚

## ä¸‰ã€é¢†åŸŸæ¨¡å‹è®¾è®¡

è™½ç„¶å¤§å®¶ç”¨çš„éƒ½æ˜¯ DDDï¼Œä¹Ÿéƒ½æœ‰å¯¹åº”çš„æ¨¡å—å’Œåˆ†åŒ…ï¼Œä½†åœ¨ç»†èŠ‚ä¹‹å¤„è¿˜æ˜¯ä¼šæœ‰ä¸€äº›å·®å¼‚ã€‚å°±åƒå®¶é‡Œçš„å®¶åº­æˆå‘˜ï¼Œè¡£æœã€è£¤å­ã€é‹å­ï¼Œæ˜¯æ‰€æœ‰äººçš„è¡£æœéƒ½æ”¾ä¸€èµ·ï¼Œè¿˜æ˜¯æ¯ä¸ªäººæœ‰ç‹¬ç«‹çš„è¡£æŸœåªæ”¾è‡ªå·±çš„ã€‚è¿™å—æ˜¯æœ‰å·®å¼‚çš„ã€‚å¦å¤–è¿™ä¸œè¥¿æ²¡æœ‰ç»å¯¹çš„å¥½å’Œåï¼Œå°±åƒå¨æˆ¿é‡Œçš„ç¢—ç­·æ˜¯æ˜¯æ”¾ä¸€èµ·çš„ï¼Œå«ç”Ÿé—´çš„é©¬æ¡¶ä¹Ÿæ˜¯å…±ç”¨çš„ï¼Œè¿™è¯´æ˜åˆ†åŒ…ä¹Ÿæ˜¯éœ€è¦æŒ‰ç…§æœ€ç¬¦åˆè‡ªå·±æ‰€éœ€æ¥è®¾å®šã€‚

### 1. åˆ†åŒ…æ–¹å¼

å¦‚ä¸‹ï¼Œæ˜¯ä¸¤ç§åˆ†åŒ…æ–¹å¼ï¼›

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/ddd-easy-guide-03-06.png)

- æ–¹å¼1ï¼›DDD é¢†åŸŸç§‘ç›®ç±»å‹åˆ†åŒ…ï¼Œç±»å‹ä¹‹ä¸‹å†™æ¯ä¸ªä¸šåŠ¡é€»è¾‘ã€‚
- æ–¹å¼2ï¼›ä¸šåŠ¡é¢†åŸŸåˆ†åŒ…ï¼Œæ¯ä¸ªä¸šåŠ¡é¢†åŸŸä¹‹ä¸‹æœ‰è‡ªå·±æ‰€éœ€çš„ DDD é¢†åŸŸç§‘ç›®ã€‚

æ¯”å¦‚ï¼Œä½ ç°åœ¨ä¸€ä¸ªå·¥ç¨‹ä¸‹æœ‰ç”¨æˆ·ã€ç§¯åˆ†ã€æŠ½å¥–ã€æ”¯ä»˜ï¼Œï¼ˆç´§å‡‘çš„èšåˆç±»å¾®æœåŠ¡æœ‰æ—¶å€™æ›´æ˜“äºç»´æŠ¤ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›åŒ…ä¸€ç§æ˜¯åˆ†ä¸ºç‹¬ç«‹çš„ä¸šåŠ¡åŒ…æ–¹å¼2è¿™ç§ï¼Œå¦å¤–ä¸€ç§å°±æ˜¯å¤§å®¶éƒ½åœ¨ä¸€ä¸ªå›å­é‡Œåƒé¥­ï¼Œè¦å•¥å»å„ä¸ªåœ°æ–¹æ‰¾ã€‚æ‰€ä»¥ä½ æ›´å€¾å‘äºé‚£ç§å‘¢ï¼Ÿ

### 2. é¢†åŸŸæ¨¡å‹

DDD é¢†åŸŸé©±åŠ¨è®¾è®¡çš„ä¸­å¿ƒï¼Œä¸»è¦åœ¨äºé¢†åŸŸæ¨¡å‹çš„è®¾è®¡ï¼Œä»¥é¢†åŸŸæ‰€éœ€é©±åŠ¨åŠŸèƒ½å®ç°å’Œæ•°æ®å»ºæ¨¡ã€‚ä¸€ä¸ªé¢†åŸŸæœåŠ¡ä¸‹é¢ä¼šæœ‰å¤šä¸ªé¢†åŸŸæ¨¡å‹ï¼Œæ¯ä¸ªé¢†åŸŸæ¨¡å‹éƒ½æ˜¯ä¸€ä¸ªå……è¡€ç»“æ„ã€‚**ä¸€ä¸ªé¢†åŸŸæ¨¡å‹ = ä¸€ä¸ªå……è¡€ç»“æ„**

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/roadmap-ddd-01.png)

- model æ¨¡å‹å¯¹è±¡ï¼›
  - aggreateï¼šèšåˆå¯¹è±¡ï¼Œå®ä½“å¯¹è±¡ã€å€¼å¯¹è±¡çš„ååŒç»„ç»‡ï¼Œå°±æ˜¯èšåˆå¯¹è±¡ã€‚
  - entityï¼šå®ä½“å¯¹è±¡ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ä½“å¯¹è±¡(Entity)ä¸æ•°æ®åº“æŒä¹…åŒ–å¯¹è±¡(PO)æ˜¯1v1çš„å…³ç³»ï¼Œä½†ä¹Ÿæœ‰ä¸ºäº†å°è£…ä¸€äº›å±æ€§ä¿¡æ¯ï¼Œä¼šå‡ºç°1vnçš„å…³ç³»ã€‚
  - valobjï¼šå€¼å¯¹è±¡ï¼Œé€šè¿‡å¯¹è±¡å±æ€§å€¼æ¥è¯†åˆ«çš„å¯¹è±¡ By ã€Šå®ç°é¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹
- repository ä»“å‚¨æœåŠ¡ï¼›ä»æ•°æ®åº“ç­‰æ•°æ®æºä¸­è·å–æ•°æ®ï¼Œä¼ é€’çš„å¯¹è±¡å¯ä»¥æ˜¯èšåˆå¯¹è±¡ã€å®ä½“å¯¹è±¡ï¼Œè¿”å›çš„ç»“æœå¯ä»¥æ˜¯ï¼›å®ä½“å¯¹è±¡ã€å€¼å¯¹è±¡ã€‚å› ä¸ºä»“å‚¨æœåŠ¡æ˜¯ç”±åŸºç¡€å±‚(infrastructure) å¼•ç”¨é¢†åŸŸå±‚(domain)ï¼Œæ˜¯ä¸€ç§ä¾èµ–å€’ç½®çš„ç»“æ„ï¼Œä½†å®ƒå¯ä»¥å¤©ç„¶çš„éš”ç¦»POæ•°æ®åº“æŒä¹…åŒ–å¯¹è±¡è¢«å¼•ç”¨ã€‚
- service æœåŠ¡è®¾è®¡ï¼›è¿™é‡Œè¦æ³¨æ„ï¼Œä¸è¦ä»¥ä¸ºå®šä¹‰äº†èšåˆå¯¹è±¡ï¼Œå°±æŠŠè¶…è¶Š1ä¸ªå¯¹è±¡ä»¥å¤–çš„é€»è¾‘ï¼Œéƒ½å°è£…åˆ°èšåˆä¸­ï¼Œè¿™ä¼šè®©ä½ çš„ä»£ç åæœŸè¶Šæ¥è¶Šéš¾ç»´æŠ¤ã€‚èšåˆæ›´åº”è¯¥æ³¨é‡çš„æ˜¯å’Œæœ¬å¯¹è±¡ç›¸å…³çš„å•ä¸€ç®€å•å°è£…åœºæ™¯ï¼Œè€ŒæŠŠä¸€äº›é‡æ ¸å¿ƒä¸šåŠ¡æ–¹åˆ° service é‡Œå®ç°ã€‚**æ­¤å¤–ï¼›å¦‚æœä½ çš„è®¾è®¡æ¨¡å¼åº”ç”¨ä¸ä½³ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ã€æµ‹è¯•é©±åŠ¨è®¾è®¡è¿˜æ˜¯æ¢äº†ä¸‰å±‚å’Œå››å±‚æ¶æ„ï¼Œä½ çš„å·¥ç¨‹è´¨é‡ä¾ç„¶ä¼šéå¸¸å·®ã€‚**
- å¯¹è±¡è§£é‡Š
  - DTO æ•°æ®ä¼ è¾“å¯¹è±¡ (data transfer object)ï¼ŒDAOä¸ä¸šåŠ¡å¯¹è±¡æˆ–æ•°æ®è®¿é—®å¯¹è±¡çš„åŒºåˆ«æ˜¯ï¼šDTOçš„æ•°æ®çš„å˜å¼‚å­ä¸è®¿é—®å­ï¼ˆmutatorå’Œaccessorï¼‰ã€è¯­æ³•åˆ†æï¼ˆparserï¼‰ã€åºåˆ—åŒ–ï¼ˆserializerï¼‰æ—¶ä¸ä¼šæœ‰ä»»ä½•å­˜å‚¨ã€è·å–ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å¼‚å¸¸ã€‚å³DTOæ˜¯ç®€å•å¯¹è±¡ï¼Œä¸å«ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œä½†å¯åŒ…å«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»¥ç”¨äºä¼ è¾“æ•°æ®ã€‚

## å››ã€åˆ†å±‚è°ƒç”¨é“¾è·¯

æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠ DDD çš„åˆ†å±‚æ¶æ„å¹³é“ºå±•å¼€ï¼Œçœ‹çœ‹ä»ä¸€ä¸ªæ¥å£çš„å®ç°åˆ°å„ä¸ªæ¨¡å—åˆ†å±‚ä¸­çš„è°ƒç”¨é“¾è·¯å…³ç³»æ˜¯ä»€ä¹ˆæ ·çš„ã€‚è¿™æ ·åœ¨åšè‡ªå·±çš„ä»£ç å¼€å‘ä¸­ä¹Ÿå¯ä»¥å‚è€ƒåˆ°åº”è¯¥æŠŠä»€ä¹ˆçš„åŠŸèƒ½åˆ†é…åˆ°å“ªä¸ªæ¨¡å—ä¸­å¤„ç†ã€‚

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/road-map-ddd-05.png)

ä»APPå±‚ã€è§¦å‘å™¨å±‚ã€åº”ç”¨å±‚ï¼Œè¿™ä¸‰å—ä¸»è¦å¯¹é¢†åŸŸå±‚çš„ä¸Šä¸‹æ–‡é€»è¾‘å°è£…ã€è§¦å‘å¼(MQã€HTTPã€JOB)ä½¿ç”¨ï¼Œå¹¶æœ€ç»ˆåœ¨åº”ç”¨å±‚ä¸­æ‰“åŒ…å‘å¸ƒä¸Šçº¿ã€‚è¿™ä¸€éƒ¨åˆ†çš„éƒ½æ˜¯ä½¿ç”¨çš„å¤„ç†ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæœ‰å¤ªå¤æ‚çš„æ“ä½œã€‚

å½“è¿›å…¥é¢†åŸŸå±‚å¼€å§‹ï¼Œä¹Ÿæ˜¯æ™ºåŠ›é›†ä¸­ä½“ç°çš„å¼€å§‹äº†ã€‚æ‰€æœ‰ä½ å¯¹å·¥ç¨‹çš„æŠ½è±¡èƒ½åŠ›ï¼Œéƒ½åœ¨è¿™ä¸€å—åŒºåŸŸä½“ç°ã€‚

## äº”ã€å·¥ç¨‹æ¶æ„æ¡ˆä¾‹

### 1. ç¯å¢ƒ

- JDK 1.8
- Maven 3.8.6
- SpringBoot 2.7.2
- MySQL 5.7 - å¦‚æœä½ ä½¿ç”¨ 8.0 è®°å¾—æ›´æ”¹ pom.xml ä¸­çš„ mysql å¼•ç”¨
- Dubbo - [https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/registry/multicast/ (opens new window)](https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/registry/multicast/)æ–‡æ¡£&å¹¿æ’­æ¨¡å¼åœ°å€è¯´æ˜

### 2. æ¶æ„

- **æºç **ï¼š[`https://gitcode.net/KnowledgePlanet/road-map/xfg-frame-ddd`(opens new window)](https://gitcode.net/KnowledgePlanet/road-map/xfg-frame-ddd)
- **æ ‘å½¢**ï¼š`å®‰è£… brew install tree` `IntelliJ IDEA Terminal ä½¿ç”¨ tree`

```
.
â”œâ”€â”€ README.md
â”œâ”€â”€ docs
â”‚   â”œâ”€â”€ dev-ops
â”‚   â”‚   â”œâ”€â”€ environment
â”‚   â”‚   â”‚   â””â”€â”€ environment-docker-compose.yml
â”‚   â”‚   â”œâ”€â”€ siege.sh
â”‚   â”‚   â””â”€â”€ skywalking
â”‚   â”‚       â””â”€â”€ skywalking-docker-compose.yml
â”‚   â”œâ”€â”€ doc.md
â”‚   â”œâ”€â”€ sql
â”‚   â”‚   â””â”€â”€ road-map.sql
â”‚   â””â”€â”€ xfg-frame-ddd.drawio
â”œâ”€â”€ pom.xml
â”œâ”€â”€ xfg-frame-api
â”‚   â”œâ”€â”€ pom.xml
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â””â”€â”€ main
â”‚   â”‚       â””â”€â”€ java
â”‚   â”‚           â””â”€â”€ cn
â”‚   â”‚               â””â”€â”€ bugstack
â”‚   â”‚                   â””â”€â”€ xfg
â”‚   â”‚                       â””â”€â”€ frame
â”‚   â”‚                           â””â”€â”€ api
â”‚   â”‚                               â”œâ”€â”€ IAccountService.java
â”‚   â”‚                               â”œâ”€â”€ IRuleService.java
â”‚   â”‚                               â”œâ”€â”€ model
â”‚   â”‚                               â”‚   â”œâ”€â”€ request
â”‚   â”‚                               â”‚   â”‚   â””â”€â”€ DecisionMatterRequest.java
â”‚   â”‚                               â”‚   â””â”€â”€ response
â”‚   â”‚                               â”‚       â””â”€â”€ DecisionMatterResponse.java
â”‚   â”‚                               â””â”€â”€ package-info.java
â”‚   â””â”€â”€ xfg-frame-api.iml
â”œâ”€â”€ xfg-frame-app
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ build.sh
â”‚   â”œâ”€â”€ pom.xml
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â”œâ”€â”€ main
â”‚   â”‚   â”‚   â”œâ”€â”€ bin
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ start.sh
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ stop.sh
â”‚   â”‚   â”‚   â”œâ”€â”€ java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ cn
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ bugstack
â”‚   â”‚   â”‚   â”‚           â””â”€â”€ xfg
â”‚   â”‚   â”‚   â”‚               â””â”€â”€ frame
â”‚   â”‚   â”‚   â”‚                   â”œâ”€â”€ Application.java
â”‚   â”‚   â”‚   â”‚                   â”œâ”€â”€ aop
â”‚   â”‚   â”‚   â”‚                   â”‚   â”œâ”€â”€ RateLimiterAop.java
â”‚   â”‚   â”‚   â”‚                   â”‚   â””â”€â”€ package-info.java
â”‚   â”‚   â”‚   â”‚                   â””â”€â”€ config
â”‚   â”‚   â”‚   â”‚                       â”œâ”€â”€ RateLimiterAopConfig.java
â”‚   â”‚   â”‚   â”‚                       â”œâ”€â”€ RateLimiterAopConfigProperties.java
â”‚   â”‚   â”‚   â”‚                       â”œâ”€â”€ ThreadPoolConfig.java
â”‚   â”‚   â”‚   â”‚                       â”œâ”€â”€ ThreadPoolConfigProperties.java
â”‚   â”‚   â”‚   â”‚                       â””â”€â”€ package-info.java
â”‚   â”‚   â”‚   â””â”€â”€ resources
â”‚   â”‚   â”‚       â”œâ”€â”€ application-dev.yml
â”‚   â”‚   â”‚       â”œâ”€â”€ application-prod.yml
â”‚   â”‚   â”‚       â”œâ”€â”€ application-test.yml
â”‚   â”‚   â”‚       â”œâ”€â”€ application.yml
â”‚   â”‚   â”‚       â”œâ”€â”€ logback-spring.xml
â”‚   â”‚   â”‚       â””â”€â”€ mybatis
â”‚   â”‚   â”‚           â”œâ”€â”€ config
â”‚   â”‚   â”‚           â”‚   â””â”€â”€ mybatis-config.xml
â”‚   â”‚   â”‚           â””â”€â”€ mapper
â”‚   â”‚   â”‚               â”œâ”€â”€ RuleTreeNodeLine_Mapper.xml
â”‚   â”‚   â”‚               â”œâ”€â”€ RuleTreeNode_Mapper.xml
â”‚   â”‚   â”‚               â””â”€â”€ RuleTree_Mapper.xml
â”‚   â”‚   â””â”€â”€ test
â”‚   â”‚       â””â”€â”€ java
â”‚   â”‚           â””â”€â”€ cn
â”‚   â”‚               â””â”€â”€ bugstack
â”‚   â”‚                   â””â”€â”€ xfg
â”‚   â”‚                       â””â”€â”€ frame
â”‚   â”‚                           â””â”€â”€ test
â”‚   â”‚                               â””â”€â”€ ApiTest.java
â”‚   â””â”€â”€ xfg-frame-app.iml
â”œâ”€â”€ xfg-frame-ddd.iml
â”œâ”€â”€ xfg-frame-domain
â”‚   â”œâ”€â”€ pom.xml
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â””â”€â”€ main
â”‚   â”‚       â””â”€â”€ java
â”‚   â”‚           â””â”€â”€ cn
â”‚   â”‚               â””â”€â”€ bugstack
â”‚   â”‚                   â””â”€â”€ xfg
â”‚   â”‚                       â””â”€â”€ frame
â”‚   â”‚                           â””â”€â”€ domain
â”‚   â”‚                               â”œâ”€â”€ order
â”‚   â”‚                               â”‚   â”œâ”€â”€ model
â”‚   â”‚                               â”‚   â”‚   â”œâ”€â”€ aggregates
â”‚   â”‚                               â”‚   â”‚   â”‚   â””â”€â”€ OrderAggregate.java
â”‚   â”‚                               â”‚   â”‚   â”œâ”€â”€ entity
â”‚   â”‚                               â”‚   â”‚   â”‚   â”œâ”€â”€ OrderItemEntity.java
â”‚   â”‚                               â”‚   â”‚   â”‚   â””â”€â”€ ProductEntity.java
â”‚   â”‚                               â”‚   â”‚   â”œâ”€â”€ package-info.java
â”‚   â”‚                               â”‚   â”‚   â””â”€â”€ valobj
â”‚   â”‚                               â”‚   â”‚       â”œâ”€â”€ OrderIdVO.java
â”‚   â”‚                               â”‚   â”‚       â”œâ”€â”€ ProductDescriptionVO.java
â”‚   â”‚                               â”‚   â”‚       â””â”€â”€ ProductNameVO.java
â”‚   â”‚                               â”‚   â”œâ”€â”€ repository
â”‚   â”‚                               â”‚   â”‚   â”œâ”€â”€ IOrderRepository.java
â”‚   â”‚                               â”‚   â”‚   â””â”€â”€ package-info.java
â”‚   â”‚                               â”‚   â””â”€â”€ service
â”‚   â”‚                               â”‚       â”œâ”€â”€ OrderService.java
â”‚   â”‚                               â”‚       â””â”€â”€ package-info.java
â”‚   â”‚                               â”œâ”€â”€ rule
â”‚   â”‚                               â”‚   â”œâ”€â”€ model
â”‚   â”‚                               â”‚   â”‚   â”œâ”€â”€ aggregates
â”‚   â”‚                               â”‚   â”‚   â”‚   â””â”€â”€ TreeRuleAggregate.java
â”‚   â”‚                               â”‚   â”‚   â”œâ”€â”€ entity
â”‚   â”‚                               â”‚   â”‚   â”‚   â”œâ”€â”€ DecisionMatterEntity.java
â”‚   â”‚                               â”‚   â”‚   â”‚   â””â”€â”€ EngineResultEntity.java
â”‚   â”‚                               â”‚   â”‚   â”œâ”€â”€ package-info.java
â”‚   â”‚                               â”‚   â”‚   â””â”€â”€ valobj
â”‚   â”‚                               â”‚   â”‚       â”œâ”€â”€ TreeNodeLineVO.java
â”‚   â”‚                               â”‚   â”‚       â”œâ”€â”€ TreeNodeVO.java
â”‚   â”‚                               â”‚   â”‚       â””â”€â”€ TreeRootVO.java
â”‚   â”‚                               â”‚   â”œâ”€â”€ repository
â”‚   â”‚                               â”‚   â”‚   â”œâ”€â”€ IRuleRepository.java
â”‚   â”‚                               â”‚   â”‚   â””â”€â”€ package-info.java
â”‚   â”‚                               â”‚   â””â”€â”€ service
â”‚   â”‚                               â”‚       â”œâ”€â”€ engine
â”‚   â”‚                               â”‚       â”‚   â”œâ”€â”€ EngineBase.java
â”‚   â”‚                               â”‚       â”‚   â”œâ”€â”€ EngineConfig.java
â”‚   â”‚                               â”‚       â”‚   â”œâ”€â”€ EngineFilter.java
â”‚   â”‚                               â”‚       â”‚   â””â”€â”€ impl
â”‚   â”‚                               â”‚       â”‚       â””â”€â”€ RuleEngineHandle.java
â”‚   â”‚                               â”‚       â”œâ”€â”€ logic
â”‚   â”‚                               â”‚       â”‚   â”œâ”€â”€ BaseLogic.java
â”‚   â”‚                               â”‚       â”‚   â”œâ”€â”€ LogicFilter.java
â”‚   â”‚                               â”‚       â”‚   â””â”€â”€ impl
â”‚   â”‚                               â”‚       â”‚       â”œâ”€â”€ UserAgeFilter.java
â”‚   â”‚                               â”‚       â”‚       â””â”€â”€ UserGenderFilter.java
â”‚   â”‚                               â”‚       â””â”€â”€ package-info.java
â”‚   â”‚                               â””â”€â”€ user
â”‚   â”‚                                   â”œâ”€â”€ model
â”‚   â”‚                                   â”‚   â””â”€â”€ valobj
â”‚   â”‚                                   â”‚       â””â”€â”€ UserVO.java
â”‚   â”‚                                   â”œâ”€â”€ repository
â”‚   â”‚                                   â”‚   â””â”€â”€ IUserRepository.java
â”‚   â”‚                                   â””â”€â”€ service
â”‚   â”‚                                       â”œâ”€â”€ UserService.java
â”‚   â”‚                                       â””â”€â”€ impl
â”‚   â”‚                                           â””â”€â”€ UserServiceImpl.java
â”‚   â””â”€â”€ xfg-frame-domain.iml
â”œâ”€â”€ xfg-frame-infrastructure
â”‚   â”œâ”€â”€ pom.xml
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â””â”€â”€ main
â”‚   â”‚       â””â”€â”€ java
â”‚   â”‚           â””â”€â”€ cn
â”‚   â”‚               â””â”€â”€ bugstack
â”‚   â”‚                   â””â”€â”€ xfg
â”‚   â”‚                       â””â”€â”€ frame
â”‚   â”‚                           â””â”€â”€ infrastructure
â”‚   â”‚                               â”œâ”€â”€ dao
â”‚   â”‚                               â”‚   â”œâ”€â”€ IUserDao.java
â”‚   â”‚                               â”‚   â”œâ”€â”€ RuleTreeDao.java
â”‚   â”‚                               â”‚   â”œâ”€â”€ RuleTreeNodeDao.java
â”‚   â”‚                               â”‚   â””â”€â”€ RuleTreeNodeLineDao.java
â”‚   â”‚                               â”œâ”€â”€ package-info.java
â”‚   â”‚                               â”œâ”€â”€ po
â”‚   â”‚                               â”‚   â”œâ”€â”€ RuleTreeNodeLinePO.java
â”‚   â”‚                               â”‚   â”œâ”€â”€ RuleTreeNodePO.java
â”‚   â”‚                               â”‚   â”œâ”€â”€ RuleTreePO.java
â”‚   â”‚                               â”‚   â””â”€â”€ UserPO.java
â”‚   â”‚                               â””â”€â”€ repository
â”‚   â”‚                                   â”œâ”€â”€ RuleRepository.java
â”‚   â”‚                                   â””â”€â”€ UserRepository.java
â”‚   â””â”€â”€ xfg-frame-infrastructure.iml
â”œâ”€â”€ xfg-frame-trigger
â”‚   â”œâ”€â”€ pom.xml
â”‚   â”œâ”€â”€ src
â”‚   â”‚   â””â”€â”€ main
â”‚   â”‚       â””â”€â”€ java
â”‚   â”‚           â””â”€â”€ cn
â”‚   â”‚               â””â”€â”€ bugstack
â”‚   â”‚                   â””â”€â”€ xfg
â”‚   â”‚                       â””â”€â”€ frame
â”‚   â”‚                           â””â”€â”€ trigger
â”‚   â”‚                               â”œâ”€â”€ http
â”‚   â”‚                               â”‚   â”œâ”€â”€ Controller.java
â”‚   â”‚                               â”‚   â””â”€â”€ package-info.java
â”‚   â”‚                               â”œâ”€â”€ mq
â”‚   â”‚                               â”‚   â””â”€â”€ package-info.java
â”‚   â”‚                               â”œâ”€â”€ rpc
â”‚   â”‚                               â”‚   â”œâ”€â”€ AccountService.java
â”‚   â”‚                               â”‚   â”œâ”€â”€ RuleService.java
â”‚   â”‚                               â”‚   â””â”€â”€ package-info.java
â”‚   â”‚                               â””â”€â”€ task
â”‚   â”‚                                   â””â”€â”€ package-info.java
â”‚   â””â”€â”€ xfg-frame-trigger.iml
â””â”€â”€ xfg-frame-types
    â”œâ”€â”€ pom.xml
    â”œâ”€â”€ src
    â”‚   â””â”€â”€ main
    â”‚       â””â”€â”€ java
    â”‚           â””â”€â”€ cn
    â”‚               â””â”€â”€ bugstack
    â”‚                   â””â”€â”€ xfg
    â”‚                       â””â”€â”€ frame
    â”‚                           â””â”€â”€ types
    â”‚                               â”œâ”€â”€ Constants.java
    â”‚                               â”œâ”€â”€ Response.java
    â”‚                               â””â”€â”€ package-info.java
    â””â”€â”€ xfg-frame-types.iml
```

ä»¥ä¸Šæ˜¯æ•´ä¸ªğŸ­å·¥ç¨‹æ¶æ„çš„ tree æ ‘å½¢å›¾ã€‚æ•´ä¸ªå·¥ç¨‹ç”± xfg-frame-app æ¨¡çš„ SpringBoot é©±åŠ¨ã€‚è¿™é‡Œå°å‚…å“¥åœ¨ domain é¢†åŸŸæ¨¡å‹ä¸‹æä¾›äº† orderã€ruleã€user ä¸‰ä¸ªé¢†åŸŸæ¨¡å—ã€‚å¹¶åœ¨æ¯ä¸ªæ¨¡å—ä¸‹æä¾›äº†å¯¹åº”çš„æµ‹è¯•å†…å®¹ã€‚è¿™å—æ˜¯æ•´ä¸ªæ¨¡å‹çš„é‡ç‚¹ï¼Œå…¶ä»–æ¨¡å—éƒ½å¯ä»¥é€šè¿‡æµ‹è¯•çœ‹åˆ°è¿™é‡Œçš„è°ƒç”¨è¿‡ç¨‹ã€‚

### 3. é¢†åŸŸ

ä¸€ä¸ªé¢†åŸŸæ¨¡å‹ä¸­åŒ…å«3ä¸ªéƒ¨åˆ†ï¼›modelã€repositoryã€service ä¸‰éƒ¨åˆ†ï¼›

- model å¯¹è±¡çš„å®šä¹‰ ã€å«æœ‰ï¼›valobj = VOã€entityã€Aggregateã€‘
- repository ä»“å‚¨çš„å®šä¹‰ã€å«æœ‰POã€‘
- service æœåŠ¡å®ç°

ä»¥ä¸Š3ä¸ªæ¨¡å—ï¼Œä¸€èˆ¬ä¹Ÿæ˜¯å¤§å®¶åœ¨ä½¿ç”¨ DDD æ—¶å€™æœ€ä¸å®¹æ˜“ç†è§£çš„åˆ†å±‚ã€‚æ¯”å¦‚ model é‡Œè¿˜åˆ†ä¸ºï¼›valobj - å€¼å¯¹è±¡ã€entity å®ä½“å¯¹è±¡ã€aggregates èšåˆå¯¹è±¡ï¼›

- **å€¼å¯¹è±¡**ï¼šè¡¨ç¤ºæ²¡æœ‰å”¯ä¸€æ ‡è¯†çš„ä¸šåŠ¡å®ä½“ï¼Œä¾‹å¦‚å•†å“çš„åç§°ã€æè¿°ã€ä»·æ ¼ç­‰ã€‚
- **å®ä½“å¯¹è±¡**ï¼šè¡¨ç¤ºå…·æœ‰å”¯ä¸€æ ‡è¯†çš„ä¸šåŠ¡å®ä½“ï¼Œä¾‹å¦‚è®¢å•ã€å•†å“ã€ç”¨æˆ·ç­‰ï¼›
- **èšåˆå¯¹è±¡**ï¼šæ˜¯ä¸€ç»„ç›¸å…³çš„å®ä½“å¯¹è±¡çš„æ ¹ï¼Œç”¨äºä¿è¯å®ä½“å¯¹è±¡ä¹‹é—´çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ï¼›

å…³äºmodelä¸­å„ä¸ªå¯¹è±¡çš„æ‹†åˆ†ï¼Œå°¤å…¶æ˜¯èšåˆçš„å®šä¹‰ï¼Œä¼šç‰µå¼•ç€æ•´ä¸ªæ¨¡å‹çš„è®¾è®¡ã€‚å½“ç„¶ä½ å¯ä»¥åœ¨åˆæœŸä½¿ç”¨ DDD çš„æ—¶å€™ä¸ç”¨è¿‡åˆ†åœ¨æ„é¢†åŸŸæ¨¡å‹çš„è®¾è®¡ï¼Œå¯ä»¥æŠŠæ•´ä¸ª domain ä¸‹çš„ä¸€ä¸ªä¸ªåŒ…å½“åšå……è¡€æ¨¡å‹ç»“æ„ï¼Œè¿™æ ·ç¼–å†™å‡ºæ¥çš„ä»£ç ä¹Ÿæ˜¯éå¸¸é€‚åˆç»´æŠ¤çš„ã€‚

### 4. ç¯å¢ƒ(å¼€å‘/æµ‹è¯•/ä¸Šçº¿)

**æºç **ï¼š`xfg-frame-ddd/pom.xml`

```xml
<profile>
    <id>dev</id>
    <activation>
        <activeByDefault>true</activeByDefault>
    </activation>
    <properties>
        <profileActive>dev</profileActive>
    </properties>
</profile>
<profile>
    <id>test</id>
    <properties>
        <profileActive>test</profileActive>
    </properties>
</profile>
<profile>
    <id>prod</id>
    <properties>
        <profileActive>prod</profileActive>
    </properties>
</profile>
```

- å®šä¹‰ç¯å¢ƒï¼›å¼€å‘ã€æµ‹è¯•ã€ä¸Šçº¿ã€‚

**æºç **ï¼š`xfg-frame-app/application.yml`

```yaml
spring:
  config:
    name: xfg-frame
  profiles:
    active: dev # devã€testã€prod
```

- é™¤äº† pom çš„é…ç½®ï¼Œè¿˜éœ€è¦åœ¨ application.yml ä¸­æŒ‡å®šç¯å¢ƒã€‚è¿™æ ·å°±å¯ä»¥å¯¹åº”çš„åŠ è½½åˆ°ï¼›`application-dev.yml`ã€`application-prod.yml`ã€`application-test.yml` è¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„åŠ è½½å¯¹åº”çš„é…ç½®ä¿¡æ¯äº†ã€‚å°¤å…¶æ˜¯å„ä¸ªåœºæ™¯ä¸­åˆ‡æ¢ä¼šæ›´åŠ æ–¹ä¾¿ã€‚

### 5. åˆ‡é¢

ä¸€ä¸ªå·¥ç¨‹å¼€å‘ä¸­ï¼Œæœ‰æ—¶å€™å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„ç»Ÿä¸€åˆ‡é¢å’Œå¯åŠ¨é…ç½®çš„å¤„ç†ï¼Œè¿™äº›å†…å®¹éƒ½å¯ä»¥åœ¨ xfg-frame-app å®Œæˆã€‚

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/road-map-230624-04.png)

**æºç **ï¼š`cn.bugstack.xfg.frame.aop.RateLimiterAop`

```java
@Slf4j
@Aspect
public class RateLimiterAop {

    private final long timeout;
    private final double permitsPerSecond;
    private final RateLimiter limiter;

    public RateLimiterAop(double permitsPerSecond, long timeout) {
        this.permitsPerSecond = permitsPerSecond;
        this.timeout = timeout;
        this.limiter = RateLimiter.create(permitsPerSecond);
    }

    @Pointcut("execution(* cn.bugstack.xfg.frame.trigger..*.*(..))")
    public void pointCut() {
    }

    @Around(value = "pointCut()", argNames = "jp")
    public Object around(ProceedingJoinPoint jp) throws Throwable {
        boolean tryAcquire = limiter.tryAcquire(timeout, TimeUnit.MILLISECONDS);
        if (!tryAcquire) {
            Method method = getMethod(jp);
            log.warn("æ–¹æ³• {}.{} è¯·æ±‚å·²è¢«é™æµï¼Œè¶…è¿‡é™æµé…ç½®[{}/ç§’]", method.getDeclaringClass().getCanonicalName(), method.getName(), permitsPerSecond);
            return Response.<Object>builder()
                    .code(Constants.ResponseCode.RATE_LIMITER.getCode())
                    .info(Constants.ResponseCode.RATE_LIMITER.getInfo())
                    .build();
        }
        return jp.proceed();
    }

    private Method getMethod(JoinPoint jp) throws NoSuchMethodException {
        Signature sig = jp.getSignature();
        MethodSignature methodSignature = (MethodSignature) sig;
        return jp.getTarget().getClass().getMethod(methodSignature.getName(), methodSignature.getParameterTypes());
    }

}
```

**ä½¿ç”¨**

```
# é™æµé…ç½®
rate-limiter:
  permits-per-second: 1
  timeout: 5
```

- è¿™æ ·ä½ æ‰€æœ‰çš„é€šç”¨é…ç½®ï¼Œåˆå’Œä¸šåŠ¡æ²¡æœ‰å¤ªå¤§çš„å…³ç³»çš„ï¼Œå°±å¯ä»¥ç›´æ¥å†™åˆ°è¿™é‡Œäº†ã€‚â€”â€” å…·ä½“å¯ä»¥å‚è€ƒä»£ç ã€‚

## å…­ã€å·¥ç¨‹æµ‹è¯•éªŒè¯

- é¦–å…ˆï¼›æ•´ä¸ªå·¥ç¨‹ç”± SpringBoot é©±åŠ¨ï¼Œæä¾›äº† road-map.sql æµ‹è¯• SQL åº“è¡¨è¯­å¥ã€‚ä½ å¯ä»¥åœ¨è‡ªå·±çš„æœ¬åœ°mysqlä¸Šè¿›è¡Œæ‰§è¡Œã€‚å®ƒä¼šåˆ›å»ºåº“è¡¨ã€‚
- ä¹‹åï¼›åœ¨ application.yml é…ç½®æ•°æ®åº“é“¾æ¥ä¿¡æ¯ã€‚
- ä¹‹åå°±å¯ä»¥æ‰“å¼€ ApiTest è¿›è¡Œæµ‹è¯•äº†ã€‚ä½ å¯ä»¥ç‚¹å‡» Application ç±»çš„ç»¿è‰²ç®­å¤´å¯åŠ¨å·¥ç¨‹ï¼Œä½¿ç”¨è§¦å‘å™¨é‡Œçš„æ¥å£è°ƒç”¨æµ‹è¯•ï¼Œæˆ–è€…å•å…ƒæµ‹è¯•RPCæ¥å£ï¼Œå°å‚…å“¥ä¹Ÿæä¾›äº†æ³›åŒ–è°ƒç”¨çš„æ–¹å¼ã€‚

![img](https://studyimages.oss-cn-beijing.aliyuncs.com/img/DDD/road-map-230624-05.png)

- å¦‚æœä½ æ­£å¸¸è·å–äº†è¿™æ ·çš„ç»“æœä¿¡æ¯ï¼Œé‚£ä¹ˆè¯´æ˜ä½ å·²ç»å¯åŠ¨æˆåŠŸã€‚æ¥ä¸‹æ¥å°±å¯ä»¥å¯¹ç…§ç€DDDçš„ç»“æ„è¿›è¡Œå­¦ä¹ ï¼Œä»¥åŠä½¿ç”¨è¿™æ ·çš„å·¥ç¨‹ç»“æ„å¼€å‘è‡ªå·±çš„é¡¹ç›®ã€‚